---
title: "Marital status with companionship and high income have positive association with the life feeling of Canadians"
author: "Yonglin Liu 1004877207/ Qiaojing Pan 1004880097/ Jiaqi Huang 1004901430/ Yifei Li 1004893635""
date: "2020/10/18"
output: html_document
---

## Title of your Report
Marital status with companionship and high income have positive association with the life feeling of Canadians

# Name(s) of Author(s) 
Yonglin Liu/
Qiaojing Pan/
Jiaqi Huang/
Yifei Li

# Date
2020/10/18

## Abstract

Here is where you give a brief (one paragraph overview of your entire paper). This should include some background/introduction, some methodology, results and conclusions.

## Introduction

Here is where you should give insight into the setting and introduce the goal of the analysis. Here you can introduce ideas and basic concepts regarding the study setting and the potential model. Again, this is the introduction, so you should be explaining the importance of the work that is ahead and hopefully build some suspense for the reader. You can also highlight what will be included in the subsequent sections.

## Data
A link to the repository is https://github.com/Bella519/STA304-PS2-life-feeling-LPHL

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r,echo=FALSE,warning=FALSE,message=FALSE}
#setwd("C:/Users/huang/Desktop/PS2")
#### Preamble ####
# Purpose: The purpose of this code is to clean-up the 2017 GSS data obtained 
# from the U of T library. That data is available to U of T students, but it needs 
# to be put into a tidy format before it can be analysed. This code does that.
# The main issue is that the data are released with codes for variables, whereas,
# we want the variable. e.g. sex is 1 or 2, but we want sex is female or male. (This
# sounds trite in that case, but gets more difficult with more involved variables.)
# So we create a dictionary type dataset that has the variable names and their 
# possible values. In that we embed some R code that will do a replacement. We 
# then apply that dataset to the raw dataset. Finally we do all the usual cleaning.
# to the dataset. You will end up with a dataset called gss.csv.
# Authors: Rohan Alexander and Sam Caetano
# Contact: rohan.alexander@utoronto.ca
# Date: 7 October 2020
# License: MIT
# Pre-reqs: You need to have downloaded the data from the library. To do that: 
  ## 1. Go to: http://www.chass.utoronto.ca/
  ## 2. Data centre --> UofT users or http://dc.chass.utoronto.ca/myaccess.html
  ## 3. Click SDA @ CHASS, should redirect to sign in. Sign in.
  ## 4. Continue in English (you're welcome to use the French, but we probably can't
  ## help you too much).
  ## 5. Crtl F GSS, click
  ## 6. Click "Data" on the one you want. We used 2017, but you may want a different 
  ## wave. In particular the General Social Survey on social identity (cycle 27), 
  ## 2013 has some variables on voter participation if you're into that sort of 
  ## thing. You're welcome to pick any year but this code applies to 2017.
  ## 7. Click download
  ## 8. Select CSV data file, data definitions for STATA (gross, but stick with it for now).
  ## 9. Can select all variables by clicking button next to green colored "All". Then continue.
  ## 10. Create the files, download and save
# Check: 
  ## You WILL need to change the raw data name. Search for .csv - line 41
  ## You may need to adjust the filepaths depending on your system. Search for: read_


#### Workspace set-up ####
library(janitor)
library(tidyverse)

# Load the data dictionary and the raw data and correct the variable names
raw_data <- read_csv("AAgjgxHA.csv")
dict <- read_lines("gss_dict.txt", skip = 18) # skip is because of preamble content
# Now we need the labels because these are the actual responses that we need
labels_raw <- read_file("gss_labels.txt")


#### Set-up the dictionary ####
# What we want is a variable name and a variable definition
variable_descriptions <- as_tibble(dict) %>% 
  filter(value!="}") %>% 
  mutate(value = str_replace(value, ".+%[0-9].*f[ ]{2,}", "")) %>% 
  mutate(value = str_remove_all(value, "\"")) %>% 
  rename(variable_description = value) %>% 
  bind_cols(tibble(variable_name = colnames(raw_data)[-1]))
 
# Now we want a variable name and the possible values
labels_raw_tibble <- as_tibble(str_split(labels_raw, ";")[[1]]) %>% 
  filter(row_number()!=1) %>% 
  mutate(value = str_remove(value, "\nlabel define ")) %>% 
  mutate(value = str_replace(value, "[ ]{2,}", "XXX")) %>% 
  mutate(splits = str_split(value, "XXX")) %>% 
  rowwise() %>% 
  mutate(variable_name = splits[1], cases = splits[2]) %>% 
  mutate(cases = str_replace_all(cases, "\n [ ]{2,}", "")) %>%
  select(variable_name, cases) %>% 
  drop_na()

# Now we have the variable name and the different options e.g. age and 0-9, 10-19, etc.
labels_raw_tibble <- labels_raw_tibble %>% 
  mutate(splits = str_split(cases, "[ ]{0,}\"[ ]{0,}"))

# The function sets up the regex (I know, I know, but eh: https://xkcd.com/208/)
add_cw_text <- function(x, y){
  if(!is.na(as.numeric(x))){
    x_new <- paste0(y, "==", x,"~")
  }
  else{
    x_new <- paste0("\"",x,"\",")
  }
  return(x_new)
}

# The function will be in the row, but it'll get the job done
cw_statements <- labels_raw_tibble %>% 
  rowwise() %>% 
  mutate(splits_with_cw_text = list(modify(splits, add_cw_text, y = variable_name))) %>% 
  mutate(cw_statement = paste(splits_with_cw_text, collapse = "")) %>% 
  mutate(cw_statement = paste0("case_when(", cw_statement,"TRUE~\"NA\")")) %>% 
  mutate(cw_statement = str_replace(cw_statement, ",\"\",",",")) %>% 
  select(variable_name, cw_statement)
# So for every variable we now have a case_when() statement that will convert 
# from the number to the actual response.

# Just do some finally cleanup of the regex.
cw_statements <- 
  cw_statements %>% 
  mutate(variable_name = str_remove_all(variable_name, "\\r")) %>% 
  mutate(cw_statement = str_remove_all(cw_statement, "\\r"))


#### Apply that dictionary to the raw data ####
# Pull out a bunch of variables and then apply the case when statement for the categorical variables
gss <- raw_data %>% 
  select(CASEID, 
         agedc, 
         achd_1c, 
         achdmpl, 
         totchdc, 
         acu0c,
         agema1c,
         achb1c,
         rsh_131a,
         arretwk,
         slm_01, 
         sex, 
         brthcan, 
         brthfcan,
         brthmcan,
         brthmacr,
         brthprvc,
         yrarri,
         prv, 
         region, 
         luc_rst, 
         marstat, 
         amb_01, 
         vismin, 
         alndimmg,
         bpr_16, 
         bpr_19,
         ehg3_01b, 
         odr_10, 
         livarr12, 
         dwelc, 
         hsdsizec,
         brthpcan,
         brtpprvc, 
         visminpr,
         rsh_125a, 
         eop_200,
         uhw_16gr,
         lmam_01, 
         acmpryr,
         srh_110,
         srh_115,
         religflg, 
         rlr_110,
         lanhome, 
         lan_01,
         famincg2, 
         ttlincg2, 
         noc1610, 
         cc_20_1,
         cc_30_1,
         ccmoc1c,
         cor_031,
         cor_041,
         cu0rnkc,
         pr_cl,
         chh0014c,
         nochricc,
         grndpa,
         gparliv,
         evermar,
         ma0_220,
         nmarevrc,
         ree_02,
         rsh_131b,
         rto_101,
         rto_110,
         rto_120,
         rtw_300,
         sts_410,
         csp_105,
         csp_110a,
         csp_110b,
         csp_110c,
         csp_110d,
         csp_160,
         fi_110) %>% 
  mutate_at(vars(agedc:fi_110), .funs = funs(ifelse(.>=96, NA, .))) %>% 
  mutate_at(.vars = vars(sex:fi_110),
            .funs = funs(eval(parse(text = cw_statements %>%
                                      filter(variable_name==deparse(substitute(.))) %>%
                                      select(cw_statement) %>%
                                      pull()))))

# Fix the names
gss <- gss %>% 
  clean_names() %>% 
  rename(age = agedc,
         age_first_child = achd_1c,
         age_youngest_child_under_6 = achdmpl,
         total_children = totchdc,
         age_start_relationship = acu0c,
         age_at_first_marriage = agema1c,
         age_at_first_birth = achb1c,
         distance_between_houses = rsh_131a,
         age_youngest_child_returned_work = arretwk,
         feelings_life = slm_01,
         sex = sex,
         place_birth_canada = brthcan,
         place_birth_father = brthfcan,
         place_birth_mother = brthmcan,
         place_birth_macro_region = brthmacr,
         place_birth_province = brthprvc,
         year_arrived_canada = yrarri,
         province = prv,
         region = region,
         pop_center = luc_rst,
         marital_status = marstat,
         aboriginal = amb_01,
         vis_minority = vismin,
         age_immigration = alndimmg,
         landed_immigrant = bpr_16,
         citizenship_status = bpr_19,
         education = ehg3_01b,
         own_rent = odr_10,
         living_arrangement = livarr12,
         hh_type = dwelc,
         hh_size = hsdsizec,
         partner_birth_country = brthpcan,
         partner_birth_province = brtpprvc,
         partner_vis_minority = visminpr,
         partner_sex = rsh_125a,
         partner_education = eop_200,
         average_hours_worked = uhw_16gr,
         worked_last_week = lmam_01,
         partner_main_activity = acmpryr,
         self_rated_health = srh_110,
         self_rated_mental_health = srh_115,
         religion_has_affiliation = religflg,
         regilion_importance = rlr_110,
         language_home = lanhome,
         language_knowledge = lan_01,
         income_family = famincg2,
         income_respondent = ttlincg2,
         occupation = noc1610,
         childcare_regular = cc_20_1,
         childcare_type = cc_30_1,
         childcare_monthly_cost = ccmoc1c,
         ever_fathered_child = cor_031,
         ever_given_birth = cor_041,
         number_of_current_union = cu0rnkc,
         lives_with_partner = pr_cl,
         children_in_household = chh0014c,
         number_total_children_intention = nochricc,
         has_grandchildren = grndpa,
         grandparents_still_living = gparliv,
         ever_married = evermar,
         current_marriage_is_first = ma0_220,
         number_marriages = nmarevrc,
         religion_participation = ree_02,
         partner_location_residence = rsh_131b,
         full_part_time_work = rto_101,
         time_off_work_birth = rto_110,
         reason_no_time_off_birth = rto_120,
         returned_same_job = rtw_300,
         satisfied_time_children = sts_410,
         provide_or_receive_fin_supp = csp_105,
         fin_supp_child_supp = csp_110a,
         fin_supp_child_exp = csp_110b,
         fin_supp_lump = csp_110c,
         fin_supp_other = csp_110d,
         fin_supp_agreement = csp_160,
         future_children_intention = fi_110) 

#### Clean up ####
gss <- gss %>% 
  mutate_at(vars(age:future_children_intention), 
            .funs = funs(ifelse(.=="Valid skip"|.=="Refusal"|.=="Not stated", "NA", .))) 

gss <- gss %>% 
  mutate(is_male = ifelse(sex=="Male", 1, 0)) 

gss <- gss %>% 
  mutate_at(vars(fin_supp_child_supp:fin_supp_other), .funs = funs(case_when(
    .=="Yes"~1,
    .=="No"~0,
    .=="NA"~as.numeric(NA)
  )))

main_act <- raw_data %>% 
  mutate(main_activity = case_when(
    mpl_105a=="Yes"~ "Working at a paid job/business",
    mpl_105b=="Yes" ~ "Looking for paid work",
    mpl_105c=="Yes" ~ "Going to school",
    mpl_105d=="Yes" ~ "Caring for children",
    mpl_105e=="Yes" ~ "Household work", 
    mpl_105i=="Yes" ~ "Other", 
    TRUE~ "NA")) %>% 
  select(main_activity) %>% 
  pull()

age_diff <- raw_data %>% 
  select(marstat, aprcu0c, adfgrma0) %>% 
  mutate_at(.vars = vars(aprcu0c:adfgrma0),
            .funs = funs(eval(parse(text = cw_statements %>%
                                      filter(variable_name==deparse(substitute(.))) %>%
                                      select(cw_statement) %>%
                                      pull())))) %>% 
  mutate(age_diff = ifelse(marstat=="Living common-law", aprcu0c, adfgrma0)) %>% 
  mutate_at(vars(age_diff), .funs = funs(ifelse(.=="Valid skip"|.=="Refusal"|.=="Not stated", "NA", .))) %>% 
  select(age_diff) %>% 
  pull()

gss <- gss %>% mutate(main_activity = main_act, age_diff = age_diff)

# Change some from strings into numbers
gss <- gss %>% 
  rowwise() %>% 
  mutate(hh_size = str_remove(string = hh_size, pattern = "\\ .*")) %>% 
  mutate(hh_size = case_when(
    hh_size=="One" ~ 1,
    hh_size=="Two" ~ 2,
    hh_size=="Three" ~ 3,
    hh_size=="Four" ~ 4,
    hh_size=="Five" ~ 5,
    hh_size=="Six" ~ 6
  )) 

gss <- gss %>% 
  rowwise() %>% 
  mutate(number_marriages = str_remove(string = number_marriages, pattern = "\\ .*")) %>% 
  mutate(number_marriages = case_when(
    number_marriages=="No" ~ 0,
    number_marriages=="One" ~ 1,
    number_marriages=="Two" ~ 2,
    number_marriages=="Three" ~ 3,
    number_marriages=="Four" ~ 4
  )) 

gss <- gss %>% 
  rowwise() %>% 
  mutate(number_total_children_known = ifelse(number_total_children_intention=="Don't know"|number_total_children_intention=="NA", 0, 1)) %>% 
  mutate(number_total_children_intention = str_remove(string = number_total_children_intention, pattern = "\\ .*")) %>% 
  mutate(number_total_children_intention = case_when(
    number_total_children_intention=="None" ~ 0,
    number_total_children_intention=="One" ~ 1,
    number_total_children_intention=="Two" ~ 2,
    number_total_children_intention=="Three" ~ 3,
    number_total_children_intention=="Four" ~ 4,
    number_total_children_intention=="Don't" ~ as.numeric(NA)
  )) 

write_csv(gss, "gss.csv")

```

```{r,ehco=FALSE£¬warning=FALSE}
library(tidyverse)
library(survey)
library(grid)
library(gridExtra)
set.seed(1234)
raw_data <- read.csv("cleaned up gss.csv")

# survey design

#create frame for 4 variables (no NA,factors)

data <- data.frame(raw_data$feelings_life,
                   raw_data$marital_status,
                   raw_data$income_family)

data <- na.omit(data)

data$raw_data.marital_status<-as.factor(data$raw_data.marital_status)

data$raw_data.income_family <- as.factor(data$raw_data.income_family)

```

In the data section, basically the following topic will be discussed:
(1)A brief introduction of the data source ¡ª2017 GSS families(the source of data, the key feature)
(2)Analysis of the questionnaire (content introduction, update of the questionnaire in 2017, and advantages and disadvantages of the questionnaire in different processing steps)
(3)Data collection (method and sampling method used, how they find people take a survey, frame, two types of errors, household filtering process, approach, what they do about non-response, the cost of the non-responders,  result of data collection and a discussion on the advantages and disadvantages of data collection steps)
(4)Data processing (the cleaning process of the raw data, methodology and approach of the data processing, trade off method of significant differences)
(5)fundamental data summary (target population, population, sample size, target sample size and two categories of data collected by GSS)
(6)discussion of the variables in the group¡¯s dataset(how do we construct the variable, a emphasis of the variables
(7)Plots of the raw data

(1)A brief introduction of the data source ¡ª2017 GSS families
	Conducted from February 2nd to November 30th in 2017,  the 2017 General Social Survey focused on family related topics. Established in 1985, the project is a full-scale, large-scale, highly analytical and competent survey organization. The purpose of its existence is to solve new problems and find new trends, and the method is telephone survey. There are two main purposes of the general social survey for social survey: one is to collect real-time data on social change trends to detect changes in living conditions of Canadians; the other is to analyze and provide the latest social policy recommendations.
	For the 2017 questionnaire, GSS focused on families. In the user guide, it is stated that: family experiences the influence of marriage and work track at the same time, in the result of changes occurred actively or passively. As Canada becomes more and more diverse, the composition of families has also changed. GSS 2017 surveys family related questions (e.g., number, characteristics, socio-economic situation, status, composition) and also gives a lot of data answers. In our group report, we will focus on the impact of marital status and family income on people's life of feeling.

(2)Analysis of the questionnaire
	A large amount of relevant data about the respondents and their family members had been collected in the questionnaire, variables such as Maternity/parental leave, Respondent¡¯s children, Characteristics of respondent of spouse/partner. These questions were developed and revised by statistical Canada's questionnaire design resource centre (QDRC). QDRC would mainly prepare questions through qualitative tests such as face-to-face interviews. Here are some new data statements related to this analysis:
	Income in 2017: no oral interview on income would be conducted in 2017, and all income information (including personal and family income) was obtained through tax data link. Those who opposed this approach can choose not to be investigated for tax data. This redefinition of the income survey greatly improves the accuracy of the data and the corresponding rate. But it is undeniable that some respondents still choose not to participate in the income survey.
	Frame in 2017: The 2017 frame was redesigned to include "mobile only" households which was also a growing population.
	Of course, there are many other updates to the GSS in 2017, and the remaining updates are covered in the scope of social democratic classification, frame, coding, processing, tax data linkage and weights.

	The above two updates are undoubtedly significant progress in the 2017 questionnaire, which has improved the coverage of users and the speed of survey. Not only that, the data in 2017 are more electronic in the process of processing and output (such as the application of common tools and CATI), which brings more accurate and convenient data transmission. Finally, it is a pity that the updated method will still leave errors in the data, because some people choose to reject the tax link survey.

(3)Data collection
	During the process of sampling, the separate province was divided into strata for further stratification, and there were two survey frame created: Lists of telephone numbers in use and The Address Register (AR). These two survey frame ensured that all homes with phone numbers are well covered.
	In the new framework after 2013, data collection through telephone made the data have both sampling and non sampling errors. The sampling error was mainly due to the respondents' lack of reply / contact / lack of information, while non-sampling survey may occur in many survey stages: The interviewee might hear wrong questions, and the electronic transmission input of CATI might be wrong. For non-sampling errors, such as the situation that the respondents refuse to answer questions, the investigators will choose to make a second call to ask and explain. However, after the survey, the answer of those who do not agree will be adjusted weight to reduce the impact of error. For sampling errors, data collection and processing were maintained at a high level and high quality. Interviewers and editors were also given training tests.
	after this, 91.8% of the selected numbers met the screening criteria (including a teenager aged 15 or above). The overall response rate of GSS in 2017 was 52.4%. The new GSS framework has led to an increase in household coverage, but there is no doubt that 52.4% is still a figure with great room for improvement. Only about half of the response rate may greatly affect the accuracy of the data.

(4)Data processing 
	As stated in the previous step, GSS 2017 had an excessively large base of interviewees and a complex multi-layer interviewing process. These complex survey data made relevant personnel use estimation and variance calculation to check the impact of survey error. However, in stratified sampling, due to the significant difference between each stratified number, people who dealt with data have to use survey weights to examine the impact of geographical / age / gender and other factors on the data.
	In the cleaning code our group has been provided with, all of the variables¡¯ name like (CASEID, agedc,  achd_1c, achdmpl, totchdc, acu0c, agema1c¡­) was formalized into a list of simple name that can be literally understood by  the content of the data(for instance, age, age_first_child, age_youngest_child_under_6, total_children, age_start_relationship, age_at_first_marriage). For the 96 / 996, 97 / 997, 98 / 998 error cases in the data, they have been processed into NA either.
	Although the data of survey is weighted different, and many analysis techniques can make the data more reasonable (for example linear expression, logistic regression, estimation of rates and proportions and analysis of variance), further the step of adding variable weight to the data with significant difference in stratification can effectively reduce the influence of error, but we can't ignore the deviation it may bring to the data.

(5)fundamental data summary
	From a statistical point of view, the target population includes all non-institutionalized Canadian residents(living in the 10 provinces of Canada) with the age of 15 years old or older.
excluding: 1. Residents of the Yukon, Northwest Territories, and Nunavut 2. Full-time residents of institutions. In 2017, the target sample size of GSS (the number of respondents expected at the moment) was 20000, while the actual number of respondents was 20602.
	At the same time, combined with the two goals of GSS, the collected data of GSS include core content and classification variables. The former refers to changes related to the measurement of living conditions / well-being, while the latter describes different population groups (e.g. age, gender, income, education). The former is used to inform specific policy issues, while the latter is used to analyze core data. In this 2017 survey, the core content and classification variables are probably future_children_intention, feelings_life and age, sex, region respectively. At the meantime, the core content used in this analysis report are marital_status, income_family, total_children, hh_size and age, while classification variable is feelings_life 


## Model

```{r,echo=FALSE}
# find estimation of survey, model

n=length(data$raw_data.feelings_life) # the number of observation

N=29225405  # the number of population

fpc.srs = rep(N,n)

feeling.design <- svydesign(id = ~1, data=data,fpc = fpc.srs)

mysvylm <- svyglm(raw_data.feelings_life~raw_data.marital_status+raw_data.income_family,
                  feeling.design,
                  family = "gaussian") 

# $100,000 to $ 124,999 is income_family's base, divorced is marital_status's base
```

We continue to analyze by constructing a linear regression model. The linear regression model is a linear approach that the parameters ($beta0,beta1,beta2,....$) enter linearly and predict the relationship between dependent variables and one or more independent variables. In addition, Devansh Goswami explained that statistical models are a simplified, mathematically-formalized way to approximate reality and optionally to make predictions from this approximation.(Goswami,2020) Hence, building a model is more useful for data analysis than without any models. 

In this case, we will discuss the relationship between the response variable "feelings_life" and two explanatory variables "marital_status and income_family " and how family's income and marital status affect respondents' life feelings. From the literature which related to the relationship between marital status & happiness and the relationship between family income & happiness, we find that higher family income and marital status like marriage can make people feel better about their lives.(Short,2016 ;  LUCAS, CLARK, GEORGELLIS, AND DIENER,2003) Hence, we will use the linear regression model to predict and prove this relationship based on our true samples. 

After using R studio with selected data, we build a linear regression model with the following formula:

$life\;feeling =  \beta_{0} +  \beta_{1}x_{livingcommon-law} +  \beta_{2}x_{married} -  \beta_{3}x_{separated} -  \beta_{4}x_{single, nevermarried} + \\\qquad \beta_{5}x_{widowed} +  \beta_{6}x_{125000andmore} -  \beta_{7}x_{25000to29999} -  \beta_{8}x_{50000to74999} -  \beta_{9}x_{75000to99999} -  \beta_{10}x_{lessthan25000}$
where $\beta_0$ is an intercept parameter which represents the value of the response variable when all other variables equal to 0. And, $\beta_1$,$\beta_2$,.......,$\beta_10$ are the slope parameters that represent the increment in the response per unit change in independent variables. 

In this situation, we know that the marital status variable and family income are categorical variables(i.e a categorical variable is one that has two or more categories) which include several types, and each type will cause a different life feeling. Hence, there are several $\beta$ for each categorical variable. Also, in this formula, the marital status divorced and family income 100,000 to 124,999 are base categories(all other categories in one variable will be compared to base one) that defines the meaning of intercept parameter. Therefore, for x_{livingcommon-law},x_{married},x_{separated},x_{single, nevermarried} and x_{widowed}, each variable is dummy variable which results in either one or zero and all of them only can exist at most one value 1. Also, x_{125000andmore},x_{25000to29999},x_{50000to74999},x_{75000to99999} and x_{lessthan25000} hold the same rules.
More detaily, 
$\beta_0$ represents the value of people's life feelings when a person's marital status is divorced with family income 100,000 to 124,999.
$\beta_1$ represents the increment of life feeling when the marital status changes from divorced to living common-law. 
$\beta_2$ represents the increment of life feeling when the marital status changes from divorced to married.
$\beta_3$ represents the increment of life feeling when the marital status changes from divorced to separated.
$\beta_4$ represents the increment of life feeling when the marital status changes from divorced to single, never married. 
$\beta_5$ represents the increment of life feeling when the marital status changes from divorced to widowed. 
$\beta_6$ represents the increment of life feeling when the family income changes from 100,000 to 124,999 to 125,000 or more. 
$\beta_7$ represents the increment of life feeling when the family income changes from 100,000 to 124,999 to 25000 to 29999. 
$\beta_8$ represents the increment of life feeling when the family income changes from 100,000 to 124,999 to 50000 to 74999. 
$\beta_9$ represents the increment of life feeling when the family income changes from 100,000 to 124,999 to 75000 to 99999. 
$\beta_10$ represents the increment of life feeling when the family income changes from 100,000 to 124,999 to less than 25000. 


For Alternative model:
The alternative model is the Bayesian statistics linear regression model. Bayesian statistics is another approach in statistics such that it assumes parameters follow some distribution. In linear regression we are trying to model: 

$life\;feeling =  \beta_{0} +  \beta_{1}x_{livingcommon-law} +  \beta_{2}x_{married} -  \beta_{3}x_{separated} -  \beta_{4}x_{single, nevermarried} + \\\qquad \beta_{5}x_{widowed} +  \beta_{6}x_{125000andmore} -  \beta_{7}x_{25000to29999} -  \beta_{8}x_{50000to74999} -  \beta_{9}x_{75000to99999} -  \beta_{10}x_{lessthan25000}$

Notice that it is a similar formula for our original models, where parameters and $x_{i}$ have the same meaning. 
Our parameters of interest are $\beta_{0}$, ¡­, $\beta_{10}$.
In Bayesian statistics, we will choose the prior distribution which is the prior belief of our parameters of interest. Here, we will assume that the prior distribution of $\beta_{i}$ is uniform(-10, 10), since we know the value of life feeling ranges from 0 to 1. Uniform(-10,10) defines equal probability over a given range -10 to 10. 
We want to find the posterior distribution by updating based on data and prior knowledge. 
We will use the brms package in R to solve for our parameter of interest.

There are some advantages of using the alternative model which is the Bayesian approach. Firstly, we can combine prior with data in a principled way, say, we can add our prior belief and as we include more data the prior becomes less influential. Secondly, using Bayesian inference we can recover all the inferences made in frequentist approach as a special case. Finally, this alternative model takes fuller account of the uncertainties related to models and parameter values. In contrast, in our original model we fixed our parameters which will impact our outcome a lot with considerable uncertainty.
On the other hand, there also are several weaknesses of this alternative model. Firstly, the alternative model takes a plenty of time to run since it requires a lot of computations. Secondly, choosing our prior is problematic. To come up with a reasonable prior requires a lot of work and thinking. In this case, we probably give a bad prior in our alternative model, since $\beta_{1}$ to $\beta_{10}$ range from -1 to 1 rather than -10 to 10. Finally, this approach demands knowledge that we have not learned. For instance, probability theory and Markov chain. 


```{r}
# Create the diagnostic plots

par(mfrow = c(2, 2))

plot(mysvylm,caption = c("figure 1: residuals vs fitted",
                         "figure 2: normal Q-Q",
                         "figure 3: scale-location",
                         "figure 4: residuals vs leverage"))

plot(mysvylm$residuals,xlab="observation order",ylab="residuals",main = "figure 5: residuals vs ordered observation")
abline(h=0,lty="dashed",col="red")


```

This is a plot that shows residuals in four different ways. Residuals represent the error between observed y value and fitted y value.

Linear regression model includes 4 assumptions. The first one is linearity of the data, which means the relationship between response variable and independent variables should be linear. The second one is normality of residuals, which means the residuals errors should be normalized. The third one is homogeneity of residuals variance, which means the variance(spread) of residuals should be constant. The last one is independence of residuals error terms.

For linearity of the data, we should look through the figure 1 "residuals vs fitted" plot. In this plot, there is no fitted pattern shown, this tells us we can assume there exists a linear relationship between response variable(life feeling) and predictor variables(family income and marital status). (STHDA, 2018)


For normality of residuals, we should look through the figure 2 "normal Q-Q" plot . In this plot, there are lots of points that do not fall along the reference line(dashed line). Hence the assumption "the normality of residuals" is failed. This reveals that the model is not adequate enough, in which errors are not random. Even though this might influence the validity of statistics like p-value, with a large sample size, this will not result in severe consequences. 

For homogeneity of residuals variance, we should look at the figure 3 "Scale-Location" plot (as same name as spread-location plot). In this plot, the red line is almost horizontal which means there is no pattern that exists, hence we can conclude that the variance of residuals are constant.

In Figure 4 ¡°Residuals vs Leverage¡± plot, we can observe how the spread of residuals change as leverages change. Based on the cook¡¯s distance, we can detect that there are many leverage points as leverage increases and influential points which are outside the red dotted line. 

For independence of residuals error terms, we should look at the "figure 5: residuals vs ordered observation" plot. By this plot, we can conclude that this assumption is satisfied because the red dashed line is horizontal. Horizontal line shows there is no pattern.


##Results

```{r,echo=FALSE}

# the data frame for plot
dataframe <- data.frame(data$raw_data.marital_status,
                        data$raw_data.income_family)


plot.design(x=dataframe,y=data$raw_data.feelings_life,cex=0.6,
            xlab = "marital status and family income factors",
            ylab = "average value of life feeling",
            main = "FIGURE 6: the average life feeling on each level of each factors",
            cex.axis = 0.7,
            lwd = 2,
            col = "deeppink3"
  
            )

```


```{r,echo=FALSE}

# table for estimate, standard error, p value

sumtable <- matrix(c(summary(mysvylm)$coefficients[1:11]%>%round(digits = 4),
                   summary(mysvylm)$coefficients[12:22]%>%round(digits = 4),
                   summary(mysvylm)$coefficients[34:44]%>%round(digits = 5)),
                   ncol=3,
                   byrow=FALSE)

colnames(sumtable) <- c("FIGURE 7:    estimate value","standard error","p value")

rownames(sumtable) <- c(" intercept",
                        "Living common-law ",
                        "Married",
                        "Separated",
                        "Single, never married",
                        "Widowed ",
                        "$125,000 ~ more",
                        "$25,000 ~ $49,999",
                        "$50,000 ~ $74,999",
                        "$75,000 ~ $99,999",
                        "Less than $25,000"
                        )

tt <- ttheme_minimal(
  core=list(bg_params = list(fill = blues9[1:6], col=NA),
            fg_params=list(fontface=3)),
            colhead=list(fg_params=list(col="navyblue", fontface=4L)),
            rowhead=list(fg_params=list(col="orange", fontface=3L)),
  )

grid.table(sumtable,theme=tt)

#----------------------------------------------------------------------------------------------------------

# table for additional information

lm = lm(mysvylm)

R_squared = summary(lm)$r.squared# R squared

residual_standard_error = summary(lm)$sigma# Residual standard error

p_value = pf(summary(lm)$fstatistic[1],summary(lm)$fstatistic[2],summary(lm)$fstatistic[3],lower.tail = FALSE)

mean_feeling = mean(data$raw_data.feelings_life) # mean of life feelings

sd_feeling = sd(data$raw_data.feelings_life) # median of standard deviation of life feeling

median_feeling = median(data$raw_data.feelings_life) # median of life feeling


sumtable2 <- matrix(c(R_squared%>%round(digits = 4),
                      residual_standard_error%>%round(digits = 4),
                      p_value,
                      mean_feeling%>%round(digits = 4),
                      sd_feeling,median_feeling)%>%round(digits = 4),
                    byrow = FALSE,
                    ncol = 1
                    )

colnames(sumtable2) <- c("FIGURE 8:   value")

rownames(sumtable2) <- c("R squared",
                        "residual standard error",
                        "statistic p value",
                        "mean of feeling life",
                        "standard deviation of feeling life",
                        "median of feeling life")

tt2 <- ttheme_minimal(
  core=list(bg_params = list(fill = blues9[1:6], col=NA),
            fg_params=list(fontface=3)),
            colhead=list(fg_params=list(col="salmon4", fontface=4L)),
            rowhead=list(fg_params=list(col="rosybrown4", fontface=3L))
  )


grid.newpage()

grid.table(sumtable2,theme=tt2)
```

Figure 6  "the average life feeling on each level of each factor" has marital status and family income factors on the x axis, and the value of life feeling as a whole on the y axis. The long horizontal line in the middle of the graph shows the average value of life feeling of our whole data set. There are two vertical lines for independent variables marital status and income family respectively, and the dash on the vertical line indicates the average value of life feeling of people who belong to the corresponding level(category). For instance, the top dash on the left vertical line demonstrates that the average value of life feeling of people who are married  is 8.43.
From the graph "the average life feeling on each level of each factor", we can observe that as income of a family increases, the well being tends to increase, and married people generally have a large value of feeling life as a whole. Here we can find out that the average value of life feeling of our data set is about 8.1. For variable marital status, people who live without a partner/spouse have an average value of life feeling less than average value of life feeling of the whole data set. Specifically,  widowed, divorced, single(never married), and separated have averages below the horizontal line y=8.1. Similarly, the average value of life feeling of people who have total family income less than 50,000 are smaller 8.1.
Figure 7 illustrates model results including estimate value, standard error of estimate, and p value of estimate. In this case, both marital status and family income are categorical variables, so predictor variables are assigned as dummy variables. Therefore, $x_{i}$'s either equal to 0 or 1 where 1 represents the presence of a qualitative attribute, and 0 represents the absence.
We get the formula

$life\;feeling = 7.9682 + 0.3521x_{livingcommon-law} + 0.5472x_{married} - 0.3639x_{separated} - 0.0588x_{single, nevermarried} + \\\qquad0.2956x_{widowed} + 0.0413x_{125000andmore} - 0.2755x_{25000to29999} - 0.1482x_{50000to74999} - 0.1073x_{75000to99999} - 0.5562x_{lessthan25000}$

$\beta_0$ = 7.9682 represents that if a person's marital status is divorced with family income $100,000 to 124,999, the average value of y life feeling is 7.9682.
$\beta_1$ = 0.3521 means if the marital status is living common-law instead of divorced, then the average of y increases 0.31521. 
$\beta_2$ = 0.5472 means if the marital status is married instead of divorced, then the average of y increases 0.5472.
$\beta_6$ = 0.0413 means if the family income is 125,000 or more instead of 100,000 to 124,999, then the average of y increases 0.0413.
Same with all other attributes $\beta_i$. 

The p-value of $\beta_4$ is 0.25907 which is larger than 0.05. Thus we have no evidence against the null hypothesis that $\beta_4$ = 0. Also, The p-value of $\beta_6$ is 0.24363, it is larger than 0.05. Thus we fail to reject the null hypothesis that $\beta_6$ = 0. The p-values for $\beta_i$ are close to 0 where i is not 4 or 6, and they are less than 0.05. Thus, we have strong evidence against the null hypothesis that $\beta_i$ = 0.

From figure 8, we can find that R squared is 0.0584, which means 5.84% of variation of y feeling life is explained by our regression line. The statistic p value for our model is 0, which means we have strong evidence against our initial hypothesis that $\beta_i$ = 0. Overall the performance is not very well.

In figure 8, we can also obtain the mean of our data set which is 8.0943 with standard derivation 1.7654.



##Discussion

The first point illustrated in the results is that individuals with companionship tend to have a higher life feeling compared with other single cases. Christopher Munsey in American psychological association states that marriage, wealth and kids do bring happiness. Besides, the second point is that people with higher income usually have a better life feeling. This is congenial with common sense and has been validated by a few researches. For example, there are two possible mechanisms among many, that can plausibly explain the positive effect of income on well-being, adaption and social comparison mechanisms. (Luis Angeles, 2010) 
With these two findings in our model, people can pursue their well-being with more feasible options and more determinedly. For example, single people can try to find someone to know and companion each other. Working people can be more motivated to work hard to get a decent income since higher income usually leads to better well-being as shown in the model. Parents can teach their childs to acquire higher level education to prevent suffering from low income in the future. (statistics Canada, 2017)
This model also provides some caveats for people in their life. For married couples, divorcing or separating largely decreases well-being, so it is important to maintain a happy relationship for themselves and their couples. For working people, earning an income below 25,000 results in a much lower life feeling compared with those who earn an income higher than 25,000. Thus, the finding in the model advises against not working and suffering from too low income.
The model is able to represent the small world but only the partial large world. For the small world, model¡¯s logic can be verified in the model itself. As for the large world, even though the model can explain or predict the life feeling with marital status and income variables to some extent, there are many other factors that the model does not cover can influence the life feeling in reality. Some surprising variables that GSS even doesn¡¯t include actually are able to influence life feeling. Meanwhile, details about marital status and income in reality are much more complicated that is hard for our model to capture.


# Weaknesses

Firstly, it is shown that R Square in our model is only 0.0584, which means that only 5.84% of variation in life feeling can be explained by our regression line. The result has two possible interpretations. Specifically, variation in marital status and income may not have a substantial effect on life feeling (James M. White, 1992) or there may be a statistical model that can better fit the data. However, it is worth noting that there is no standard rule to measure how large R Square should be in each model. Secondly, deletion of missing values results in lower statistical power and possible biases. There are many missing values in the data collected by the survey as expected since some respondents might not be willing or able to answer specific questions in the questionnaire. Deletion of values decreases data size and thus reduces the statistical power. Meanwhile, it is possible that these missing values reveal some underlying informationIn, so the deleted missing values may lead to some unknown biases in the model. Thirdly, new frame combined with telephone may result in selection bias as households without telephone were excluded from the survey population. This may result in an unrepresentative target population. 

# Next Steps

There is some further work to be done. First, it is suggested to try to use the Bayesian model or other nonlinear models to do the regression. Specifically, Bayesian models may be able to fit the relationship better and provide more possibilities for analysis. The nonlinear model, such as quadratic or cubic varieties, may also be able to fit the relationship and explain the life feeling better. Second, regressing on some other variables may help us better find Canandian¡¯s well being, such as age(James M. White, 1992), mental health or household size. Thirdly, another method to collect data instead of depending entirely on telephone may be a good choice since some people may not have telephones. Thus, data would be collected in a more complete and inclusive way. 


## References

Advisorperspectives.com. 2020. [online] Available at: <https://www.advisorperspectives.com/dshort/commentaries/2016/10/21/happiness-revisited-a-household-income-of-75k> [Accessed 19 October 2020].

Apa.org. 2020. [online] Available at: <https://www.apa.org/pubs/journals/releases/psp-843527.pdf> [Accessed 19 October 2020].

Caetano, S., 2020. Weblogin Idpz | University Of Toronto. [online] Q.utoronto.ca. Available at: <https://q.utoronto.ca/courses/184060/modules/items/1867317> [Accessed 19 October 2020].

Column, R., Scriven, R. and C, V., 2020. R Get All Categories In Column. [online] Stack Overflow. Available at: <https://stackoverflow.com/questions/46017812/r-get-all-categories-in-column> [Accessed 19 October 2020]. 

DataMentor. 2020. R Boxplot() To Create Box Plot (With Numerous Examples). [online] Available at: <https://www.datamentor.io/r-programming/box-plot/> [Accessed 19 October 2020]. 

Editor, M., 2020. How Important Are Normal Residuals In Regression Analysis?. [online] Blog.minitab.com. Available at: <https://blog.minitab.com/blog/adventures-in-statistics-2/how-important-are-normal-residuals-in-regression-analysis> [Accessed 19 October 2020].

Essentials, L., 2020. Linear Regression Assumptions And Diagnostics In R: Essentials - Articles - STHDA. [online] Sthda.com. Available at: <http://www.sthda.com/english/articles/39-regression-model-diagnostics/161-linear-regression-assumptions-and-diagnostics-in-r-essentials/#regression-assumptions> [Accessed 19 October 2020].

Gla.ac.uk. 2020. [online] Available at: <https://www.gla.ac.uk/media/Media_110443_smxx.pdf> [Accessed 19 October 2020].

Government of Canada, Statistics Canada. ¡°General Social Survey ¨C Family (GSS).¡± Government of Canada, Statistics Canada, 30 Apr. 2020, sda-artsci-utoronto-ca.myaccess.library.utoronto.ca/sdaweb/html/gss.htm.

SAGE Journals. 2020. Marital Status And Well-Being In Canada: An Analysis Of Age Group Variations - JAMES M. WHITE, 1992. [online] Available at: <https://journals.sagepub.com/doi/10.1177/019251392013003008> [Accessed 19 October 2020].

tatsnwt.ca. 2020. [online] Available at: <https://www.statsnwt.ca/census/2016/Age-Sex_final.pdf> [Accessed 19 October 2020].

Theworldcounts.com. 2020. The World Counts. [online] Available at: <https://www.theworldcounts.com/happiness/the-effect-of-income-on-happiness> [Accessed 19 October 2020].

Www12.statcan.gc.ca. 2020. Census In Brief: Does Education Pay? A Comparison Of Earnings By Level Of Education In Canada And Its Provinces And Territories. [online] Available at: <https://www12.statcan.gc.ca/census-recensement/2016/as-sa/98-200-x/2016024/98-200-x2016024-eng.cfm> [Accessed 19 October 2020].
